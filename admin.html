<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

  <!-- <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> -->
  <title>Admin Page</title>
  
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  
  <div class="container">
    
    <h1 class="mt-4 mb-4">Admin Page</h1>


      <div class="form-group">
        <img id="outputImage" src="https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png" style="max-width: 400px; width: 100%; border: 1px solid #ccc;" class="rounded d-block my-auto" alt="...">
        <div class="alert alert-success my-3" id="success-alert" style="display: none;">
          <strong>Success!</strong>
        </div>


        <div class="my-2">
            <label for="formFile" class="form-label">Select image</label>
            <canvas id="outputCanvas" style="display: none;"></canvas>
            <input class="form-control" type="file" id="imageInput" accept="image/*" onchange="convertToWebP(event)">
          </div>
       
        <label for="categorySelect">Select Category</label>
        <select class="form-control" id="categorySelect">
          <option>Gallery</option>
          <option>Events</option>
          <option>Captain</option>
          <option>ViceCaptain</option>
          <option>Chassis</option>
          <option>VehicleDynamics</option>
          <option>PowerTrain</option>
          <option>Braking</option>
          <option>Electronics</option>
          <option>Admin</option>
          <option>Marketing</option>
          <option>Coverage</option>
          <option>WebsiteGraphics</option>
        </select>
      </div>
      <div class="form-group mt-2">
        <label for="titleInput">Title</label>
        <input type="text" class="form-control" id="titleInput" placeholder="optional">
      </div>
      <div class="form-group mt-2">
        <label for="subTitleInput">Sub-Title</label>
        <input type="text" class="form-control" id="subTitleInput" placeholder="optional">
      </div>
      <button id="uploadBtn" type="submit" class="btn btn-primary mt-3" onclick="upload()">Submit</button>
  
    </div>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

   <script>

    function convertToWebP(event) {
              const input = event.target;
              const canvas = document.getElementById('outputCanvas');
              const outputImage = document.getElementById('outputImage');
  
              const file = input.files[0];
              const reader = new FileReader();
  
              reader.onload = function (e) {
                  const img = new Image();
                  img.src = e.target.result;
  
                  img.onload = function () {
                      canvas.width = img.width;
                      canvas.height = img.height;
                      const ctx = canvas.getContext('2d');
                      ctx.drawImage(img, 0, 0, img.width, img.height);
  
                      const webpData = canvas.toDataURL('image/webp');
                      outputImage.src = webpData;
  
                      // Show the preview
                      outputImage.style.display = 'block';
                  };
              };
  
              reader.readAsDataURL(file);
          }
  
          function upload() {
              const outputImage = document.getElementById('outputImage');
              
              // Check if an image has been converted and is displayed
              if (outputImage.src) {
                  const webpData = outputImage.src.split(',')[1]; // Extract base64 data
                  sendToServer(webpData);
              } else {
                  alert('Please select an image and convert it to WebP first.');
              }
          }
  
          function sendToServer(webpData) {
              const xhr = new XMLHttpRequest();
              xhr.open('POST', 'upload.php', true);
              xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  
              xhr.onreadystatechange = function () {
                  if (xhr.readyState == 4 && xhr.status == 200) {
                      console.log(xhr.responseText);
                     
                      
                        $("#success-alert").fadeTo(2000, 500).slideUp(500, function() {
                          $("#success-alert").slideUp(500);
                        });
                      
                  }
              };
  
              const params = 'webpData=' + encodeURIComponent(webpData)
                          +  '&category=' + encodeURIComponent(document.getElementById('categorySelect').value)
                          +  '&title=' + encodeURIComponent(document.getElementById('titleInput').value)
                          +  '&subTitle=' + encodeURIComponent(document.getElementById('subTitleInput').value);
              xhr.send(params);
          }
  </script>
  

</body>


</html>